<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <!-- Material Design for Bootstrap fonts and icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">

    <!-- Material Design for Bootstrap CSS -->
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css" integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX" crossorigin="anonymous">
       
    <!--Sweet Alert2-->
    <script src="../sweetalert.js"></script>

    <title>Página do Usuário</title>
  </head>
     
     <style>
          fieldset {
               background-color: #eeeeee;
          }

          legend {
               background-color: gray;
               color: white;
               padding: 5px 10px;
          }
          input{
               box-shadow: 0 0 0 0 !important;
          }
          label{
            margin-left: 8px;
          }
          .fa-trash{
            color: red;
            vertical-align: middle;
          }
     </style>

     <body onload="myFunction()">

          <form id="cadastrarLivro" style="margin: 30px 30px 0 30px;">
               <fieldset style="border: 1px solid black; border-radius: 10px 10px 10px 10px !important;">
                    <legend style="text-align: center; border-radius: 10px 10px 10px 10px !important; width: 300px">Cadastro de Livros</legend>
                    <div class="form-group bmd-form-group">
                    <label for="formGroupExampleInput2" style="color: black;" class="bmd-label-floating">Titulo *</label>
                    <input type="text" class="form-control" id="tituloInformado">
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-6">
                    <label for="exampleInputEmail2" class="bmd-label-floating" style="color: black;">Autor *</label>
                    <input type="text"class="form-control" id="autorInformado">
                    </div>
                    <div class="form-group col-md-6">
                         <label for="exampleInputEmail2" class="bmd-label-floating" style="color: black;">Editora *</label>
                         <input type="text" class="form-control" id="editoraInformado">
                    </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group col-md-6">
                         <label for="exampleInputEmail2" style="color: black;">Ano de Publicação *</label>
                         <input type="date" class="form-control" id="anoPublicacaoInformado">
                         </div>
                         <div class="form-group col-md-6">
                              <label for="exampleInputName2" class="bmd-label-floating" style="color: black">Genero *</label>
                              <input type="text" class="form-control" id="generoInformado">
                         </div>
                    </div>
                    <div align="center" style="margin-bottom: 20px; margin-top: 10px">
                         <button type="button" class="btn btn-primary btn-raised" data-dismiss="modal" data-toggle="modal" data-target="#exampleModalCenterEdit">Editar</button>
                         <button type="submit" class="btn btn-secondary btn-raised">Cadastrar</button>
                         <button type="button" class="btn btn-danger btn-raised" data-toggle="modal" data-target="#exampleModalCenter">Deletar</button>
                    </div>
               </fieldset>
          </form>

          <!--Modal Delete-->
	      <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	        <div class="modal-dialog modal-dialog-centered" role="document">
	          <div class="modal-content">
	            <div class="modal-header">
	              <h5 class="modal-title" id="exampleModalLongTitle">Informe o título do livro.</h5>
	              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                <span aria-hidden="true">&times;</span>
	              </button>
	            </div>
	            <div class="modal-body">
	              <div class="form-group bmd-form-group">
	            <label for="formGroupExampleInput2" style="color: black;" class="bmd-label-floating">Título *</label>
	            <input type="text" class="form-control" id="tituloParaDeletar" maxlength="40">
	          </div>
	            </div>
	            <div class="modal-footer">
	              <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
	              <button id="buttonDelete" type="submit" class="btn btn-danger">Deletar</button>
	            </div>
	          </div>
	        </div>
	      </div>

	    <!--Modal Edit-->
	      <div class="modal fade" id="exampleModalCenterEdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	        <div class="modal-dialog modal-dialog-centered" role="document">
	          <div class="modal-content">
	            <div class="modal-header">
	              <h5 class="modal-title" id="exampleModalLongTitle">Informe o título do livro.</h5>
	              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                <span aria-hidden="true">&times;</span>
	              </button>
	            </div>
	            <div class="modal-body">
	              <div class="form-group bmd-form-group">
	            <label for="formGroupExampleInput2" style="color: black;" class="bmd-label-floating">Título *</label>
	            <input type="text" class="form-control" id="tituloParaEditar" maxlength="40">
	          </div>
	            </div>
	            <div class="modal-footer">
	              <button type="button" class="btn btn-secondary" data-dismissx="modal">Fechar</button>
	              <button id="carregarLivro" type="submit" class="btn btn-danger">Carregar</button>
	            </div>
	          </div>
	        </div>
	      </div>

        <main style="margin: 30px">

            <table class="table" style="border: 1px solid black;">
        <thead class="thead-dark">
          <tr>
            <th scope="col">Título</th>
            <th scope="col">Autor</th>
            <th scope="col">Editora</th>
            <th scope="col">Ano de Públicação</th>
            <th scope="col">Gênero</th>
          </tr>
        </thead>
        <tbody id="list">

        </tbody>
      </table> 

  </main>

     <script type="text/javascript">
        let list = document.querySelector("#list");

        function myFunction() {

        fetch('http://localhost:8080/api/cliente/13/livros', {
          method: 'GET',
	      supportHeaderParams: true,
	      headers: {
	        'Accept': 'application/json',
	        'Content-Type': 'application/json'
	      }
        })
        .then(response => response.json())
        .then(data => {
            data.forEach(function (tb_users) {
                    let item = document.createElement("tr");
                   
                   item.classList.add("item");

                   var str = new Date(tb_users.anoPublicacao).toLocaleString('pt-BR');
    
                    item.innerHTML =  '<td>'+tb_users.titulo+'</td>' +
                              '<td>'+tb_users.autor+'</td>' +
                              '<td>'+tb_users.editora+'</td>' +
                              '<td>'+str.substr(0,10)+'</td>' +
                              '<td>'+tb_users.genero+'</td>';

              list.appendChild(item);

               });
        });
        };
     </script>

    <!--  <script type="text/javascript">
      let buttonDelete = document.querySelector("#buttonDelete");
      var tituloParaDeletar = document.querySelector("#tituloParaDeletar");

      buttonDelete.addEventListener("click", function(event){

      // event.preventDefault();
      function alertSucess(msg){
        Swal.fire({
          type: "success",
          icon: "success",
          text: `${msg}`,
          showConfirmButton: false,
          timer: 2000
        });
      }

      function alertError(msg){
        Swal.fire({
            type: "error",
            icon: "error",
            text: `${msg}`,
            showConfirmButton: false,
            timer: 2000
        })
      }

      fetch('http://localhost:8080/api/cliente/13/livros/'+tituloParaDeletar.value, {
        method: 'DELETE',
        supportHeaderParams: true,
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        }
      })

      .then(function(response) {
        return response
      })
      .then(function(response) {
        if(!response.ok){
          throw Error(response.statusText);
        }else{

          alertSucess("Livro deletado com sucesso!!");
          setTimeout(function(){ 
            document.location.reload(true);
          }, 2000);

        }
      })
      .catch(e => alertSucess("Título incorreto, por favor informe corretamente!!"))
    })

     </script> -->

    <script type="text/javascript">

      	let carregarLivro = document.querySelector("#carregarLivro");
      	let tituloParaEditar = document.querySelector("#tituloParaEditar");
      	let tInformado = document.querySelector("#tituloInformado");

    	carregarLivro.addEventListener("click", function(event){

    		function alertSucess(msg){
		        Swal.fire({
		          type: "success",
		          icon: "success",
		          text: `${msg}`,
		          showConfirmButton: false,
		          timer: 2000
		        });
	     	}

	      	function alertError(msg){
		        Swal.fire({
		            type: "error",
		            icon: "error",
		            text: `${msg}`,
		            showConfirmButton: false,
		            timer: 2000
		        })
	      	}

	        fetch('http://localhost:8080/api/cliente/13/livros/'+tituloParaEditar.value, {
	        
	          method: 'GET',
	          supportHeaderParams: true,
	          headers: {
	            'Accept': 'application/json',
	            'Content-Type': 'application/json'
	          }
	        })
	        .then(response => response.json())
	        .then(data => {
	            
		            $('#exampleModalCenterEdit').modal('hide');
		            setTimeout(function(){ 
		            	document.body.lastChild.remove();
		          	}, 500);

		            setTimeout(function(){ 
		            	let dateComeco = data.anoPublicacao.substr(0, 8);
		            	let dateFim = data.anoPublicacao.substr(9, 10);
		            	dateFim = parseInt(dateFim) - 1;
		            	dateFim = dateFim.toString()
		            	if(dateFim.length == 1){
		            		dateFim = "0"+dateFim;
		            	}
		          		document.querySelector("#tituloInformado").value = data.titulo;
		          		document.querySelector("#autorInformado").value = data.autor;
		          		document.querySelector("#editoraInformado").value = data.editora;
		          		document.querySelector("#anoPublicacaoInformado").value = (dateComeco + dateFim);
		          		document.querySelector("#generoInformado").value = data.genero;
		          	}, 1000);
	          	
	        })
	        .catch(e => alertError("Titulo incorreto, por favor informe corretamente!!"))
     	});

    </script>

     <script src="https://use.fontawesome.com/9275e65a6d.js"></script>
     <script type="text/javascript" src="../js/cadastrarLivro.js"></script>

     <!-- Optional JavaScript -->
     <!-- jQuery first, then Popper.js, then Bootstrap JS -->
     <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
     <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js" integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js" integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9" crossorigin="anonymous"></script>
  <script>$(document).ready(function() { $('body').bootstrapMaterialDesign(); });</script>

</body>
</html>